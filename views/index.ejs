<!DOCTYPE html>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="mynodeapp/view/styling.css" rel="stylesheet" type="text/css">
       <%- include('style'); %>


    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- Bootstrap button -->
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    

    <!-- flatpickr -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://npmcdn.com/flatpickr/dist/themes/material_blue.css" type="text/css">

    <!-- flatpickr plugin -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shortcut-buttons-flatpickr@0.1.0/dist/themes/material_blue.min.css">
    <script src="https://cdn.jsdelivr.net/npm/shortcut-buttons-flatpickr@0.1.0/dist/shortcut-buttons-flatpickr.min.js"></script>

    <title>TweeBook</title>

</head>
<body>

    <h1 id="h1">TweeBook</h1>
    <div class="container">
        <div class="row">
            <div class="col" id="left">
                <h2>New Tweet</h2>
                <textarea id="text-area" name="tweet" rows="5" cols="70" placeholder="What's happening?" maxlength="280"></textarea>
                <div id="remaining-chars">280 characters remaining</div>
                <script>
                                    
                    var textArea = document.getElementById("text-area");
                    var remainingChars = document.getElementById("remaining-chars");
                    var maxChars = 280;

                    textArea.addEventListener("input", countChar);
                    
                    function countChar() {
                        var remaining = maxChars - textArea.value.length;
                        var remainingColour = remaining < 20 ? "red" : "black";
                        remainingChars.textContent = `${remaining} characters remaining`;
                        remainingChars.style.color = remainingColour;
                    }
                
                </script>
                <div class="button" id="tweetButton" type="submit">Tweet</div>
                
                <form class="flatpickr">
                    <div class="col col-lg-5">
                        <input id="calendar" placeholder="Schedule date/time" data-input>
                    </div>
                </form>
            </div>

            <!-- Left column ends -->

           <div class="col" id="right">
                <table class="responsive-table table">
                <thead>
                    <h2>Hashtag Search</h2>
                    <div class="main-search-input-wrap">
                        <div class="main-search-input fl-wrap">
                            <form action="/" method="post">
                            <div class="main-search-input-item"> 
                            <fieldset>
                                <div class="input-group">
                                <input class="form-control" name="hashtag" placeholder="Search a popular term or #hashtag" required type="text">
                                </div>
                            </fieldset>
                            </div> 
                                <button class="main-search-button" input type="submit" value="books">Search</button>
                            </form>
                        </div>
                    </div>
                </thead>

                <tbody>
                    <div class="col col-lg-12" id="right-content">


                        <div>
                            <% if(hashtag !== null){ %>
                                <h3>All popular tweets for #<%- hashtag %></h3>
                                <% } %>
                        </div>
                    
                    <div id="tweets"></div>
                    
                    
                        <% if(twitterData !== null){ %>
                           
                        <script>
                            let twitterData = <%- JSON.stringify(twitterData) %>;
                            let tweetHTML = '<div class="row">';
                            for (let index = 0; index < twitterData.statuses.length; index++) {
                                var createdDateTime = new Date(twitterData.statuses[index].created_at).toUTCString();
                    
                                tweetHTML += '<div class="col-sm-12"><div class="card mb-3">' +
                                    '<div class="card-body">' +
                                    '<h5 class="card-title">@' + twitterData.statuses[index].user.screen_name + '</h5>' +
                                    '<h6 class="card-subtitle mb-2 text-muted">' + twitterData.statuses[index].user.name + '</h6>' +
                                    '<p class="card-text">' + twitterData.statuses[index].text + '<</p>' +
                                    '<p class="card-text"><i class="fa fa-retweet" aria-hidden="true"></i> ' + twitterData.statuses[index].retweet_count + ' <i class="fa fa-heart" style="color:red;" aria-hidden="true"></i> ' + twitterData.statuses[index].favorite_count + '</p>' +
                                    
                                  //  '<a class="card-link" href="#">Another link</a>' +
                                    '<p class="card-text"><small class="text-muted">Created on '+createdDateTime.toString()+' </small></p>' +
                                    '</div>' +
                                    '</div>' +
                                    '</div>';
                            }
                            tweetHTML += '</div>';
                    
                            var tweetsContainer = document.getElementById('tweets');
                            tweetsContainer.insertAdjacentHTML('beforeend', tweetHTML);
                        </script>
                        <% } %>
                        </div>

                    </div>
                </tbody>
                </table>
            </div>    
        </div>
    </div>


    <!-- flatpickr scheduling -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script> -->
    <!-- <script src="node_modules/requirejs/require.js"></script> -->
    
    <script src="node_modules/requirejs/require.js">

        const flatpickr = require("flatpickr");

    flatpickr("#calendar", {
    enableTime: true,
            dateFormat: "Y-m-d H:i",
            altInput: true,
            altFormat: "F j, Y (h:i K)",
            minDate: "today",
    plugins: [
        ShortcutButtonsPlugin({
        button: [
            {label: "Clear"},
            {label: "Today"},
            {label: "Tomorrow"}
        ],
        onClick: (index, fp) => {
            let date;
            switch (index) {
            case 0:
                fp.clear();
                fp.close();
                break;
            case 1:
                date = new Date();
                break;
            case 2:
                date = new Date(Date.now() + 24 * 60 * 60 * 1000);
                break;
            }
            fp.setDate(date);
        }
        })
    ]
    });
    </script>

  </body>
</html>